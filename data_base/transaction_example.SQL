CREATE TABLE some_persons (
  id SERIAL,
  first_name VARCHAR(50),
  last_name VARCHAR(50),
  dob DATE,
  email VARCHAR(255),
  PRIMARY KEY (id)
);

COPY some_persons(first_name, last_name, dob, email)
FROM '/usr/src/persons.csv'
DELIMITER ',';


DROP TABLE IF EXISTS accounts;

CREATE TABLE accounts (
    id INT GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    balance DEC(15,2) NOT NULL,
    PRIMARY KEY(id)
);

INSERT INTO accounts(name,balance)
VALUES('John',10000);

SELECT id,
    name,
    balance
FROM
    accounts;


BEGIN;

UPDATE accounts
    SET balance = balance - 200
WHERE id = 1;

ROLLBACK;
COMMIT;


-- SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
BEGIN;

SELECT id,
    name,
    balance
FROM
    accounts;

INSERT INTO accounts(name,balance)
VALUES('Bob',35000);

SAVEPOINT my_point;

INSERT INTO accounts(name,balance)
VALUES('Sam',40000);

INSERT INTO accounts(name,balance)
VALUES('Will',50000);

RELEASE SAVEPOINT my_point;

ROLLBACK TO SAVEPOINT my_point;

COMMIT;

ROLLBACK;